jQuery.fn.TableCSVExport=function(f){var f=jQuery.extend({separator:",",header:[],columns:[],extraHeader:"",extraData:[],insertBefore:"",delivery:"popup",emptyValue:"",showHiddenRows:false,rowFilter:"",filename:"download.csv"},f);var j=[];var c=this;var e=f.columns.length==0?true:false;var s=[];var b=0;var n=null;var h=f.header.length;var q=[];if(h>0){if(e){for(var p=0;p<h;p++){if(f.header[p]==f.insertBefore){q[q.length]=l(f.extraHeader);n=p}q[q.length]=l(f.header[p])}}else{if(!e){for(var m=0;m<h;m++){for(var p=0;p<f.columns.length;p++){if(f.columns[p]==f.header[m]){if(f.columns[p]==f.insertBefore){q[q.length]=l(f.extraHeader);n=m}q[q.length]=l(f.header[m]);s[b]=m;b++}}}}}}else{r(c).find("th").each(function(){if(jQuery(this).css("display")!="none"||f.showHiddenRows){q[q.length]=l(jQuery(this).html())}})}d(q);if(e){var g=0;k(c).each(function(){var i=[];var o=0;r(this).find("td").each(function(){if(o==n){i[i.length]=jQuery.trim(f.extraData[g-1])}if(jQuery(this).css("display")!="none"||f.showHiddenRows){if(jQuery.trim(jQuery(this).html())==""){i[i.length]=l(f.emptyValue)}else{i[i.length]=jQuery.trim(l(jQuery(this).html()))}}o++});d(i);g++})}else{var g=0;k(c).each(function(){var i=[];var u=0;var o=0;r(this).find("td").each(function(){if((u in s)&&(o==n)){i[i.length]=jQuery.trim(l(f.extraData[g-1]))}if((jQuery(this).css("display")!="none"||f.showHiddenRows)&&(u in s)){i[i.length]=jQuery.trim(l(jQuery(this).html()))}u++;o++});d(i);g++})}function k(i){return jQuery(i).find("tr"+f.rowFilter)}function r(i){if(f.showHiddenRows){return jQuery(i)}else{return jQuery(i).filter(":visible")}}if((f.delivery=="popup")||(f.delivery=="download")){var t=j.join("\n");return a(t)}else{var t=j.join("\n");return t}function d(i){var u=i.join("");if(i.length>0&&u!=""){var o=i.join(f.separator);j[j.length]=jQuery.trim(o)}}function l(o){var u=new RegExp(/["]/g);var i=o.replace(u,'""');i=i.replace("<br>"," ");if(!(i!=null&&typeof i==="object")){i="<span>"+i+"</span>"}i=$(i).text().trim();if(i==""){return""}return'"'+i+'"'}function a(w){if(f.delivery=="download"){var i=new Blob(["\ufeff"+w],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob){navigator.msSaveBlob(i,f.filename)}else{var v=document.createElement("a");var o=URL.createObjectURL(i);var u=navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1;if(u){v.setAttribute("target","_blank")}v.setAttribute("href",o);v.setAttribute("download",f.filename);v.style="visibility:hidden";document.body.appendChild(v);v.click();document.body.removeChild(v)}return true}else{var x=window.open("","csv","height=400,width=600");x.document.write("<html><head><title>CSV</title>");x.document.write("</head><body >");x.document.write('<textArea cols=70 rows=15 wrap="off" >');x.document.write(w);x.document.write("</textArea>");x.document.write("</body></html>");x.document.close();return true}}};